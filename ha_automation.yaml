alias: Air Baltic Price Alert
description: Sends a notification when Air Baltic price changes or exceeds threshold
triggers:
  - entity_id: sensor.airbaltic_ams_oul_price
    trigger: state
    not_to: unknown
actions:
  - variables:
      current_price: "{{ states('sensor.airbaltic_ams_oul_price') | float(0) }}"
      price_min_threshold: 150  # Alert if price below this (EUR) - GOOD DEAL!
      price_max_threshold: 200  # Alert if price above this (EUR) - EXPENSIVE
  - if:
      - condition: template
        value_template: "{{ current_price < price_min_threshold }}"
    then:
      - data:
          title: "ðŸŽ‰ Great Deal! Air Baltic - AMS â†’ OUL"
          message: >
            Price: {{ current_price }} â‚¬
            
            âœ… Price is below {{ price_min_threshold }}â‚¬ - GOOD PRICE!
        action: notify.notify
  - if:
      - condition: template
        value_template: "{{ current_price > price_max_threshold }}"
    then:
      - data:
          title: "âš ï¸ Expensive! Air Baltic - AMS â†’ OUL"
          message: >
            Price: {{ current_price }} â‚¬
            
            âŒ Price is above {{ price_max_threshold }}â‚¬ - EXPENSIVE!
        action: notify.notify
  - if:
      - condition: template
        value_template: "{{ (current_price >= price_min_threshold) and (current_price <= price_max_threshold) }}"
    then:
      - data:
          title: "âœˆï¸ Air Baltic Price Update"
          message: "AMS â†’ OUL: {{ current_price }} â‚¬ (Normal price)"
        action: notify.notify
mode: queued
